#!/bin/bash

# –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ç–∞—Ç–µ–π –¥–ª—è Detailing Marketing
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./generate-article.sh "–¢–µ–º–∞ —Å—Ç–∞—Ç—å–∏" "–∫–ª—é—á–µ–≤–∏–∫1, –∫–ª—é—á–µ–≤–∏–∫2"

CONTENT_DIR="../content/blog"
PROMPT_FILE="../prompts/article-prompt.md"
GUIDE_FILE="../prompts/article-guide.md"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
if [ -z "$1" ]; then
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./generate-article.sh \"–¢–µ–º–∞ —Å—Ç–∞—Ç—å–∏\" \"–∫–ª—é—á–µ–≤–∏–∫–∏\""
    echo ""
    echo "–ü—Ä–∏–º–µ—Ä:"
    echo "  ./generate-article.sh \"–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CRM –¥–ª—è –¥–µ—Ç–µ–π–ª–∏–Ω–≥–∞\" \"crm, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, –¥–µ—Ç–µ–π–ª–∏–Ω–≥\""
    exit 1
fi

TOPIC="$1"
KEYWORDS="${2:-}"

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è slug –∏–∑ —Ç–µ–º—ã
SLUG=$(echo "$TOPIC" | \
    sed 's/[–ê–∞]/a/g; s/[–ë–±]/b/g; s/[–í–≤]/v/g; s/[–ì–≥]/g/g; s/[–î–¥]/d/g; s/[–ï–µ]/e/g; s/[–Å—ë]/yo/g' | \
    sed 's/[–ñ–∂]/zh/g; s/[–ó–∑]/z/g; s/[–ò–∏]/i/g; s/[–ô–π]/y/g; s/[–ö–∫]/k/g; s/[–õ–ª]/l/g' | \
    sed 's/[–ú–º]/m/g; s/[–ù–Ω]/n/g; s/[–û–æ]/o/g; s/[–ü–ø]/p/g; s/[–†—Ä]/r/g; s/[–°—Å]/s/g' | \
    sed 's/[–¢—Ç]/t/g; s/[–£—É]/u/g; s/[–§—Ñ]/f/g; s/[–•—Ö]/h/g; s/[–¶—Ü]/ts/g; s/[–ß—á]/ch/g' | \
    sed 's/[–®—à]/sh/g; s/[–©—â]/sch/g; s/[–™—ä]//g; s/[–´—ã]/y/g; s/[–¨—å]//g; s/[–≠—ç]/e/g' | \
    sed 's/[–Æ—é]/yu/g; s/[–Ø—è]/ya/g' | \
    tr '[:upper:]' '[:lower:]' | \
    sed 's/[^a-z0-9]/-/g' | \
    sed 's/--*/-/g' | \
    sed 's/^-//' | \
    sed 's/-$//')

FILENAME="$CONTENT_DIR/$SLUG.md"
DATE=$(date +%Y-%m-%d)

echo "üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç—å–∏"
echo "   –¢–µ–º–∞: $TOPIC"
echo "   –ö–ª—é—á–µ–≤–∏–∫–∏: $KEYWORDS"
echo "   –§–∞–π–ª: $FILENAME"
echo ""

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
PROMPT=$(cat <<EOF
–ü—Ä–æ—á–∏—Ç–∞–π –≥–∞–π–¥ –ø–æ —Å—Ç–∏–ª—é:

$(cat "$GUIDE_FILE")

---

–¢–µ–ø–µ—Ä—å –∑–∞–¥–∞–Ω–∏–µ:

**–¢–µ–º–∞:** $TOPIC

**–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:** $KEYWORDS

**–î–∞—Ç–∞:** $DATE

–ù–∞–ø–∏—à–∏ —Å—Ç–∞—Ç—å—é –æ–±—ä—ë–º–æ–º 800-1500 —Å–ª–æ–≤. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û markdown-—Ñ–∞–π–ª, –Ω–∞—á–∏–Ω–∞—è —Å frontmatter (---).
EOF
)

echo "–ü—Ä–æ–º–ø—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω. –°–∫–æ–ø–∏—Ä—É–π –µ–≥–æ –∏ –≤—Å—Ç–∞–≤—å –≤ Claude:"
echo ""
echo "============================================"
echo "$PROMPT"
echo "============================================"
echo ""
echo "–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–∏ –µ–≥–æ –≤: $FILENAME"
