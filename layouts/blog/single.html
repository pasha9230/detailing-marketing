{{ define "main" }}
<nav class="breadcrumbs">
  <a href="/blog/">Блог</a>
  {{ with .Params.category }}
  {{ with index $.Site.Params.categories . }}
   → <a href="/categories/{{ $.Params.category }}/">{{ .name }}</a>
  {{ end }}
  {{ end }}
</nav>

<article>
  <header class="article-header">
    {{ with .Params.category }}
    {{ with index $.Site.Params.categories . }}
    <div class="category">{{ .name }}</div>
    {{ end }}
    {{ end }}

    <h1>{{ .Title }}</h1>

    {{ with .Params.description }}
    <p class="description">{{ . }}</p>
    {{ end }}

    <div class="meta">
      {{ $.Date.Format "2 января 2006" }} · {{ $.Site.Params.author }}
    </div>
  </header>

  {{ with .Params.cover }}
  <img class="article-cover" src="{{ . }}" alt="{{ $.Title }}">
  {{ end }}

  <div class="content">
    {{ .Content }}
  </div>

  <div class="cta" id="cta-block">
    <p>Вопросы? Обсудим вашу ситуацию</p>
    <a href="{{ (index .Site.Params.social 0).url }}" onclick="ym(106364826,'reachGoal','telegram_cta_click'); return true;">Написать в Telegram</a>
  </div>

  <footer>
    {{ .Date.Format "Январь 2006" }}
  </footer>
</article>

<script>
(function() {
  var ctaBlock = document.getElementById('cta-block');
  if (!ctaBlock) return;
  var ctaSeen = false;
  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (entry.isIntersecting && !ctaSeen) {
        ctaSeen = true;
        ym(106364826, 'reachGoal', 'scroll_to_cta');
        observer.disconnect();
      }
    });
  }, { threshold: 0.5 });
  observer.observe(ctaBlock);
})();
</script>
{{ end }}
